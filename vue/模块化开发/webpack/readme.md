# å†…å®¹æ¦‚è¿°

## è®¤è¯†webpack

* ä»€ä¹ˆæ˜¯webpack?
  * è¿™ä¸ªwebpackè¿˜çœŸä¸æ˜¯ä¸€ä¸¤å¥è¯å¯ä»¥è¯´æ¸…æ¥šçš„.

* å®˜æ–¹è§£é‡Š:
  * At it's core, __webpack__ is a _static module bundler_ for modern JavaScript applications.
  * ä»æœ¬è´¨ä¸Šæ¥è®², webpackæ˜¯ä¸€ä¸ªç°ä»£çš„JavaScriptåº”ç”¨çš„é™æ€ __æ¨¡å—æ‰“åŒ…__ å·¥å…·.

* ä½†å®ƒæ˜¯ä»€ä¹ˆå‘¢? ç”¨æ¦‚å¿µè§£é‡Šæ¦‚å¿µ, è¿˜æ˜¯ä¸æ¸…æ™°.
  * æˆ‘ä»¬ä»ä¸¤ä¸ªç‚¹æ¥è§£é‡Šä¸Šçº¿è¿™å¥è¯: __æ¨¡å—__ å’Œ __æ‰“åŒ…__.
[webpack](./imgs/what is webpack.jpg)
* webpack å¯ä»¥ä½œä¸ºä¸€ä¸ªåº•å±‚æ”¯æ’‘:
  * ğŸŒ°: æˆ‘ä»¬å¯ä»¥åœ¨commonJSä¸­ç¼–å†™é€»è¾‘, ä½¿ç”¨webpackæ‰“åŒ…, å°†jså¤„ç†å®Œæˆå®Œæˆå,å¯ä»¥ä½¿å¤§å¤šæ•°æµè§ˆå™¨é€‚åº”é«˜ç‰ˆæœ¬jsä»£ç , æ‰“åŒ…å®ŒæˆåcommonJSä¸ä¼šå­˜åœ¨äºæ–‡ä»¶å¤¹;å…¶æ¬¡, cssã€ims åœ¨webpack ä¸­ä¹Ÿä½œä¸ºä¸€ä¸ªæ¨¡å—å­˜åœ¨.
* __æ¨¡å—__
  * __æ­¤å¤„å†…å®¹å…³è”./æ¨¡å—åŒ–å¼€å‘/æ¨¡å—åŒ–å¼€å‘.md ä¸­çš„å‰ç«¯æ¨¡å—åŒ–__
* __æ‰“åŒ…__ å¦‚ä½•ç†è§£å‘¢?
  * ç†è§£äº†webpackå¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›é¡¹æ¨¡å—åŒ–, å¹¶ä¸”å¤„ç†æ¨¡å—é—´çš„å„ç§å¤æ‚å…³ç³»å, æ‰“åŒ…çš„æ¦‚å¿µå°±éå¸¸å¥½ç†è§£äº†.
  * å°±æ˜¯å°†webpackä¸­çš„å„ç§èµ„æºæ¨¡å—è¿›é¡¹æ‰“åŒ…åˆå¹¶æˆä¸€ä¸ªæˆ–å¤šä¸ªåŒ…(Bundle).
  * å¹¶ä¸”åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­, è¿˜å¯ä»¥å¯¹èµ„æºè¿›è¡Œå¤„ç†, æ¯”å¦‚å‹ç¼©å›¾ç‰‡, å°†scssè½¬æ¢æˆcss, å°†ES6è¯­æ³•è½¬æˆES5è¯­æ³•, å°†TSè½¬æ¢æˆJSç­‰ç­‰æ“ä½œ.
  * ä½†æ˜¯æ‰“åŒ…çš„æ“ä½œä¼¼ä¹grunt/gulpä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆ, ä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒå‘¢?
  * å’Œgrunt/gulpçš„å¯¹æ¯”
    * grunt/gulpçš„æ ¸å¿ƒæ˜¯Task
      * æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ç³»åˆ—çš„task, å¹¶ä¸”å®šä¹‰tas(ä»»åŠ¡æµ)kè¦å¤„ç†çš„äº‹åŠ¡(ä¾‹å¦‚ES6ã€TSè½¬åŒ–, å›¾ç‰‡å‹ç¼©, scssè½¬æˆcss)
      * ä¹‹åè®©grunt/gulpæ¥ä¾æ¬¡æ‰§è¡Œè¿™äº›task, è€Œä¸”è®©æ•´ä¸ªæµç¨‹è‡ªåŠ¨åŒ–.
      * æ‰€ä»¥grunt/gulp ä¹Ÿè¢«æˆä¸ºå‰ç«¯è‡ªåŠ¨åŒ–ä»»åŠ¡ç®¡ç†å·¥å…·.
    * æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªgulpçš„task
      * ä¸‹é¢çš„taskå°±æ˜¯å°†srcä¸‹é¢çš„æ‰€æœ‰jsæ–‡ä»¶è½¬æ¢æˆES5çš„è¯­æ³•, å¹¶ä¸”æœ€ç»ˆè¾“å‡ºåˆ°distæ–‡ä»¶å¤¹ä¸­.

      ```gulp
        const gulp = require('gulp');
        const babel = require('gulp-babel');

        gulp.task('js', () =>
          gulp.src('src/*.js')
            .pipe(babel({
              presets: ['es2015']
            }))
            .pipe(gulp.dest('dist'))
        );
      ```

      * ä»€ä¹ˆæ—¶å€™ç”¨grunt/gulpå‘¢?
        * å·¥ç¨‹ä¾èµ–éå¸¸ç®€å•;
        * åªéœ€è¦è¿›è¡Œç®€å•çš„åˆå¹¶ã€å‹ç¼©, å°±ä½¿ç”¨grunt/gulpå³å¯;
        * ä½†æ˜¯å¦‚æœæ•´ä¸ªé¡¹ç›®ä½¿ç”¨äº†æ¨¡å—åŒ–ç®¡ç†, è€Œä¸”ç›¸äº’ä¾èµ–éå¸¸å¼º, æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ›´åŠ å¼ºå¤§çš„webpackäº†.
  
  * æ‰€ä»¥grunt/gulpå’Œwebpackæœ‰ä»€ä¹ˆä¸åŒå‘¢?
    * grunt/gulp æ›´åŠ å¼ºè°ƒçš„å‰ç«¯æµç¨‹çš„è‡ªåŠ¨åŒ–, æ¨¡å—åŒ–ä¸æ˜¯ä»–çš„æ ¸å¿ƒ.
    * webpackæ›´åŠ å¼ºè°ƒæ¨¡å—åŒ–å¼€å‘ç®¡ç†, è€Œæ–‡ä»¶å‹ç¼©åˆå¹¶, é¢„å¤„ç†ç­‰åŠŸèƒ½, æ˜¯ä»–é™„å¸¦çš„åŠŸèƒ½.

## webpackçš„å®‰è£…

* å®‰è£…webpacké¦–å…ˆéœ€è¦å®‰è£… __Node.js__ , Node.jsè‡ªå¸¦äº†è½¯ä»¶åŒ…ç®¡ç†å·¥å…·npm
* æŸ¥çœ‹è‡ªå·±çš„nodeç‰ˆæœ¬
  * node -v
* å…¨å±€å®‰è£…webpack(è·Ÿç€è€å¸ˆå®‰è£…3.6.0ç‰ˆæœ¬, å› ä¸ºvue cli2ä¾èµ–è¯¥ç‰ˆæœ¬)
  * npm install webpack@3.6.0 -g
* å±€éƒ¨å®‰è£…webpack(åç»­æ‰éœ€è¦)
  * --save-dev æ˜¯å¼€å‘æ—¶ä¾èµ–, é¡¹ç›®æ‰“åŒ…åä¸éœ€è¦ç»§ç»­ä½¿ç”¨çš„.
  * cd å¯¹åº”ç›®å½•
  * npm install webpack@3.6.0 --save-dev
* ä¸ºä»€ä¹ˆå…¨å±€å®‰è£…å, è¿˜éœ€è¦å±€éƒ¨å®‰è£…å‘¢?
  * åœ¨ç»ˆç«¯ç›´æ¥æ‰§è¡Œwebpackå‘½ä»¤, ä½¿ç”¨çš„å…¨å±€å®‰è£…çš„webpack;
  * å½“åœ¨package.jsonä¸­å®šä¹‰äº†scriptsæ—¶, å…¶ä¸­åŒ…å«äº†webpackå‘½ä»¤, é‚£ä¹ˆä½¿ç”¨çš„æ˜¯å±€éƒ¨webpack.

## webpackçš„èµ·æ­¥

* dist -> distribution(å‘å¸ƒ)
* æ–‡ä»¶å¯¼å…¥
  * 1. ä½¿ç”¨ common.js çš„æ¨¡å—åŒ–è§„èŒƒå¯¼å…¥: const { varName, ... } = require('./..');
  * 2. ä½¿ç”¨ ES6 çš„æ¨¡å—åŒ–è§„èŒƒ: import { varName, ... } from './..';

## webpackçš„é…ç½®

* npm init åˆå§‹åŒ–é¡¹ç›®ä¿¡æ¯;

* åœ¨ç»ˆç«¯é‡Œä½¿ç”¨çš„åŒ…éƒ½æ˜¯ä½¿ç”¨å…¨å±€çš„åŒ…;

* åœ¨ package.json ä¸­çš„ scripts ä¸­å®šä¹‰è¿è¡Œè„šæœ¬, ä¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ°çš„åŒ…;

## loaderçš„ä½¿ç”¨

* å®‰è£… loader: npm install --save-dev css-loader/style-loader

## webpackä¸­é…ç½®Vue

* vue åœ¨æ„å»ºæ—¶, æ„å»ºäº†ä¸¤ä¸ªç‰ˆæœ¬
  * runtime-onle --> åœ¨æ„å»ºæ­¤ç‰ˆæœ¬æ—¶, ä¸å…è®¸æœ‰ä»»ä½• template ( {{}} ä¹Ÿæ˜¯template);
  <!-- ä¼šæŠ¥é”™: You are using the runtime-only build of Vue where the template compiler is not available. Either pre-compile the templates into render functions, or use the compiler-included build. -->
  * runtime-compiler --> ä»£ç ä¸­, å¯ä»¥æœ‰ template, å› ä¸ºæœ‰ compiler å¯ä»¥ç¼–è¾‘ template;

* .vue æ–‡ä»¶æ¨èæ–‡ä»¶åé¦–å­—æ¯å¤§å†™

## pluginçš„ä½¿ç”¨

* plugin æ˜¯ä»€ä¹ˆ?
  * plugin æ˜¯æ’ä»¶çš„æ„æ€, é€šå¸¸æ˜¯ç”¨äºå¯¹æŸä¸ªç°æœ‰çš„æ¶æ„è¿›è¡Œæ‰©å±•;
  * webpack ä¸­çš„æ’ä»¶, å°±æ˜¯å¯¹ webpack ç°æœ‰åŠŸèƒ½çš„å„ç§æ‰©å±•, æ¯”å¦‚æ‰“åŒ…ä¼˜åŒ–, æ–‡ä»¶å‹ç¼©ç­‰ç­‰ã€‚

* loader å’Œ plugin çš„åŒºåˆ«
  * loader ä¸»è¦ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—, å®ƒæ˜¯ä¸€ä¸ªè½¬æ¢å™¨;
  * plugin æ˜¯æ’ä»¶, å®ƒæ˜¯å¯¹ webpack æœ¬èº«çš„æ‰©å±•, æ˜¯ä¸€ä¸ªæ‰©å±•å™¨ã€‚

* plugin çš„ä½¿ç”¨è¿‡ç¨‹
  * 1. é€šè¿‡ npm å®‰è£…éœ€è¦ä½¿ç”¨çš„ plugins (æŸäº› webpack å·²ç»å†…ç½®çš„æ’ä»¶ä¸éœ€è¦å®‰è£…);
  * 2. åœ¨ webpack.config.js ä¸­çš„ plugins ä¸­é…ç½®æ’ä»¶ã€‚

* plugins
  * æ‰“åŒ… html çš„ plugin
    * ç›®å‰æˆ‘ä»¬çš„ index.html æ–‡ä»¶æ˜¯å­˜æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹çš„
      * æˆ‘ä»¬çŸ¥é“, åœ¨çœŸå®å‘å¸ƒé¡¹ç›®æ—¶, å‘å¸ƒçš„æ˜¯ dist æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹, ä½†æ˜¯ dist æ–‡ä»¶å¤¹ä¸­å¦‚æœæ²¡æœ‰ index.html æ–‡ä»¶, é‚£ä¹ˆæ‰“åŒ…çš„ js ç­‰æ–‡ä»¶ä¹Ÿå°±æ²¡æœ‰æ„ä¹‰äº†;
      * æ‰€ä»¥, æˆ‘ä»¬éœ€è¦å°† index.html æ–‡ä»¶æ‰“åŒ…åˆ° dist æ–‡ä»¶å¤¹ä¸­, è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ HtmlWebpackPlugin æ’ä»¶
    * HtmlWebpackPlugin æ’ä»¶å¯ä»¥ä¸ºæˆ‘ä»¬åšè¿™äº›äº‹æƒ…:
      * è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª index.html æ–‡ä»¶(å¯ä»¥æŒ‡å®šæ¨¡æ¿æ¥ç”Ÿæˆ)
      * å°†æ‰“åŒ…çš„jsæ–‡ä»¶, è‡ªåŠ¨é€šè¿‡ script æ ‡ç­¾æ’å…¥åˆ° body ä¸­ã€‚
    * å®‰è£… HtmlWebpackplugin æ’ä»¶
      * ``` npm install html-webpack-plugin --save-dev ```
    * ä½¿ç”¨æ’ä»¶, ä¿®æ”¹ webpack,config.js æ–‡ä»¶ä¸­çš„ plugins éƒ¨åˆ†çš„å†…å®¹å¦‚ä¸‹:

      ```JavaScript
        plugins: [
          new htmlWebpackPlugin({
            template: 'index.html' // ä¼šåœ¨é…ç½®æ–‡ä»¶ç›®å½•ä¸‹å¯»æ‰¾è¯¥æ¨¡æ¿
          }),
        ]
      ```

      * è¿™é‡Œçš„ template è¡¨ç¤ºæ ¹æ®ä»€ä¹ˆæ¨¡æ¿æ¥ç”Ÿæˆ index.html;
      * å¦å¤–, æˆ‘ä»¬éœ€è¦åˆ é™¤ä¹‹å‰åœ¨ output ä¸­æ·»åŠ çš„ publicPath å±æ€§, å¦åˆ™æ’å…¥çš„ script æ ‡ç­¾ä¸­çš„ src å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚
  * å‹ç¼© js çš„plugin
    * åœ¨é¡¹ç›®å‘å¸ƒä¹‹å‰, æˆ‘ä»¬å¿…ç„¶éœ€è¦å¯¹ js ç­‰æ–‡ä»¶è¿›è¡Œå‹ç¼©å¤„ç†
      * è¿™é‡Œ, æˆ‘ä»¬å°±å¯¹æ‰“åŒ…çš„ js æ–‡ä»¶è¿›è¡Œå‹ç¼©;
      * æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„æ’ä»¶ uglifyjs-webpack-plugin, å¹¶ä¸”ç‰ˆæœ¬å·æŒ‡å®š 1.1.1, å’Œ CLI2 ä¿æŒä¸€è‡´
      * ``` npm install uglifyjs-webpack-plugin@1.1.1 --save-dev ```
    * ä¿®æ”¹ webpack.config.js æ–‡ä»¶, ä½¿ç”¨æ’ä»¶:

    ```javascript
      Plugins: [
        new uglifyjsPlugin()
      ]  
    ```

## æ­å»ºæœ¬åœ°æœåŠ¡å™¨

* webpakc æä¾›äº†ä¸€ä¸ªå¯é€‰çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨, è¿™ä¸ªæœåŠ¡å™¨åŸºäº node.js æ­å»º, å†…éƒ¨ä½¿ç”¨ express æ¡†æ¶, å¯ä»¥å®ç°æˆ‘ä»¬æƒ³è¦çš„è®©æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæˆ‘ä»¬ä¿®æ”¹åçš„ç»“æœï¼›

* ä¸è¿‡å®ƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—, åœ¨ webpack ä¸­ä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆå®‰è£…å®ƒ
  * ``` npm install --save-dev webpack-dev-derver@2.9.1 ```

* devserver ä¹Ÿæ˜¯ä½œä¸º webpack ä¸­çš„ä¸€ä¸ªé€‰é¡¹, é€‰é¡¹æœ¬èº«å¯ä»¥è®¾ç½®å¦‚ä¸‹å±æ€§:
  * constentBase: ä¸ºå“ªä¸€ä¸ªæ–‡ä»¶å¤¹æä¾›æœ¬åœ°æœåŠ¡, å¶äººæ˜¯æ ¹æ–‡ä»¶å¤¹, æˆ‘ä»¬è¿™é‡Œè¦å¡«å†™ './dist'
  * port: ç«¯å£å·
  * inline: é¡µé¢å®æ—¶åˆ·æ–°
  * historyApiFallback: åœ¨ SPA é¡µé¢ä¸­, ä¾èµ– HTML5 çš„ history æ¨¡å¼(åç»­è·¯ç”±ä¼šè®²åˆ°)

* webpack.config.js æ–‡ä»¶é…ç½®ä¿®æ”¹å¦‚ä¸‹:

  ```JavaScript
    devServer: {
      contentBase: './dist',
      inline: true
    },
  ```

* æˆ‘ä»¬å¯ä»¥å†é…ç½®å¦å¤–ä¸€ä¸ª scripts:
  * --open å‚æ•°æ ‡è¯†ç›´æ¥æ‰“å¼€æµè§ˆå™¨
  * ``` "dev": "webpack-dev-server --open" ```
